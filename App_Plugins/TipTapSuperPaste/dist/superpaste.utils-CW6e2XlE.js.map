{"version":3,"file":"superpaste.utils-CW6e2XlE.js","sources":["../client/src/superpaste.utils.ts"],"sourcesContent":["// Regex to remove invisible/control characters from text\nconst INVISIBLE_CHARS_REGEX =\n    /[\\u0000-\\u0008\\u000B\\u000C\\u000E-\\u001F\\u007F-\\u009F\\u00AD\\u034F\\u061C\\u115F\\u1160\\u17B4\\u17B5\\u180B-\\u180F\\u200B-\\u200F\\u202A-\\u202E\\u2060-\\u206F\\uFEFF]/g;\n\nexport function cleanText(input: string): string {\n    return input\n        .replace(/\\u00A0/g, ' ') // nbsp -> space\n        .replace(INVISIBLE_CHARS_REGEX, '')\n        .trim();\n}\n\nfunction cleanWordCruft(html: string): string {\n    let str = html;\n\n    // Remove Office namespace tags\n    str = str.replace(/<o:p>\\s*<\\/o:p>/gi, '');\n    str = str.replace(/<o:p>.*?<\\/o:p>/gi, ' ');\n    str = str.replace(/<\\/?\\w+:[^>]*>/gi, ''); // Remove all namespace tags like <o:p>, <w:sdt>, etc.\n    str = str.replace(/<\\\\?\\?xml[^>]*>/gi, '');\n\n    // Remove mso-* styles\n    str = str.replace(/\\s*mso-[^:]+:[^;\"]+;?/gi, '');\n\n    // Remove specific Word styles\n    str = str.replace(/\\s*MARGIN:\\s*0cm 0cm 0pt\\s*;?/gi, '');\n    str = str.replace(/\\s*TEXT-INDENT:\\s*[^;]+;?/gi, '');\n    str = str.replace(/\\s*TEXT-ALIGN:\\s*[^;]+;?/gi, '');\n    str = str.replace(/\\s*PAGE-BREAK-BEFORE:\\s*[^;]+;?/gi, '');\n    str = str.replace(/\\s*FONT-VARIANT:\\s*[^;]+;?/gi, '');\n    str = str.replace(/\\s*tab-stops:[^;\"]*;?/gi, '');\n    str = str.replace(/\\s*FONT-FAMILY:\\s*[^;\"]*;?/gi, '');\n    str = str.replace(/\\s*font-family:\\s*[^;\"]*;?/gi, '');\n    str = str.replace(/\\s*FONT-SIZE:\\s*[^;\"]*;?/gi, '');\n    str = str.replace(/\\s*font-size:\\s*[^;\"]*;?/gi, '');\n    str = str.replace(/\\s*line-height:\\s*[^;\"]*;?/gi, '');\n    str = str.replace(/\\s*color:\\s*[^;\"]*;?/gi, '');\n    str = str.replace(/\\s*background[^:]*:\\s*[^;\"]*;?/gi, '');\n\n    // Remove face attribute\n    str = str.replace(/\\s*face=\"[^\"]*\"/gi, '');\n    str = str.replace(/\\s*face=[^ >]*/gi, '');\n\n    // Remove lang attribute\n    str = str.replace(/\\s*lang=\"[^\"]*\"/gi, '');\n    str = str.replace(/\\s*lang=[^ >]*/gi, '');\n\n    // Remove empty style attributes\n    str = str.replace(/\\s*style=\"\\s*\"/gi, '');\n    str = str.replace(/\\s*style=''/gi, '');\n\n    // Remove empty spans\n    str = str.replace(/<span\\s*[^>]*>\\s*<\\/span>/gi, '');\n    str = str.replace(/<span\\s*>\\s*<\\/span>/gi, '');\n\n    // Unwrap simple spans (no attributes)\n    str = str.replace(/<span\\s*>([\\s\\S]*?)<\\/span>/gi, '$1');\n\n    // Remove font tags but keep content\n    str = str.replace(/<\\/?font[^>]*>/gi, '');\n\n    // Remove style and script blocks\n    str = str.replace(/<style[^>]*>[\\s\\S]*?<\\/style>/gi, '');\n    str = str.replace(/<script[^>]*>[\\s\\S]*?<\\/script>/gi, '');\n\n    // Remove HTML comments\n    str = str.replace(/<!--[\\s\\S]*?-->/gi, '');\n\n    // Remove meta and link tags\n    str = str.replace(/<meta[^>]*>/gi, '');\n    str = str.replace(/<link[^>]*>/gi, '');\n\n    return str;\n}\n\nfunction isListParagraph(el: Element): boolean {\n    const className = el.className || '';\n    return className.includes('MsoListParagraph') || className.includes('MsoListParagraphCxSp');\n}\n\nfunction isNumberedList(text: string): boolean {\n    return /^\\s*\\d+[\\.\\)]\\s/.test(text);\n}\n\nfunction stripBulletMarkers(html: string): string {\n    // Remove bullet characters and numbered list markers from the start\n    return html\n        .replace(/^[\\s·•●○■□▪▫–\\-]+\\s*/g, '')\n        .replace(/^\\s*\\d+[\\.\\)]\\s*/g, '')\n        .trim();\n}\n\nfunction cleanElementAttributes(el: Element): void {\n    // Remove class and most style attributes, but element stays\n    el.removeAttribute('class');\n    el.removeAttribute('style');\n    el.removeAttribute('lang');\n    el.removeAttribute('face');\n}\n\nfunction processElement(el: Element): string {\n    const tagName = el.tagName.toLowerCase();\n\n    // Handle formatting tags - keep them but clean attributes\n    if (['strong', 'b', 'em', 'i', 'u', 's', 'strike', 'sub', 'sup'].includes(tagName)) {\n        cleanElementAttributes(el);\n        const inner = processChildren(el);\n        if (!inner.trim()) return '';\n        return `<${tagName}>${inner}</${tagName}>`;\n    }\n\n    // Remove spans, keep content\n    if (tagName === 'span') {\n        return processChildren(el);\n    }\n\n    // For other elements, just process children\n    return processChildren(el);\n}\n\nfunction processChildren(el: Element): string {\n    let result = '';\n    for (const node of Array.from(el.childNodes)) {\n        if (node.nodeType === Node.TEXT_NODE) {\n            result += node.textContent || '';\n        } else if (node.nodeType === Node.ELEMENT_NODE) {\n            result += processElement(node as Element);\n        }\n    }\n    return result;\n}\n\nexport function cleanWordHtml(html: string): string {\n    // Step 1: Regex cleanup of Word cruft\n    let cleanedHtml = cleanWordCruft(html);\n\n    // Step 2: Parse and process with DOM\n    const container = document.createElement('div');\n    container.innerHTML = cleanedHtml;\n\n    // Handle full HTML documents - extract body content\n    let contentContainer: Element = container;\n    const bodyElement = container.querySelector('body');\n    if (bodyElement) {\n        contentContainer = bodyElement;\n    }\n\n    // Process all children in order to properly group lists\n    const result: string[] = [];\n    let currentList: { type: 'ul' | 'ol'; items: string[] } | null = null;\n\n    const flushList = () => {\n        if (currentList && currentList.items.length > 0) {\n            const tag = currentList.type;\n            const items = currentList.items.map(item => `<li>${item}</li>`).join('');\n            result.push(`<${tag}>${items}</${tag}>`);\n            currentList = null;\n        }\n    };\n\n    for (const child of Array.from(contentContainer.children)) {\n        const tagName = child.tagName.toLowerCase();\n\n        if (tagName === 'p') {\n            if (isListParagraph(child)) {\n                const rawText = child.textContent || '';\n                const isNumbered = isNumberedList(rawText);\n                const listType = isNumbered ? 'ol' : 'ul';\n\n                // Flush if list type changes\n                if (currentList && currentList.type !== listType) {\n                    flushList();\n                }\n\n                if (!currentList) {\n                    currentList = { type: listType, items: [] };\n                }\n\n                // Process the content, preserving formatting\n                let itemHtml = processChildren(child);\n                itemHtml = stripBulletMarkers(itemHtml);\n                itemHtml = cleanText(itemHtml);\n\n                if (itemHtml) {\n                    currentList.items.push(itemHtml);\n                }\n            } else {\n                // Regular paragraph - flush list first\n                flushList();\n\n                let content = processChildren(child);\n                content = cleanText(content);\n\n                if (content) {\n                    result.push(`<p>${content}</p>`);\n                }\n            }\n        } else if (['ul', 'ol'].includes(tagName)) {\n            // Already a list - flush current and add\n            flushList();\n            cleanElementAttributes(child);\n            child.querySelectorAll('li').forEach(li => {\n                cleanElementAttributes(li);\n            });\n            result.push(child.outerHTML);\n        } else if (['h1', 'h2', 'h3', 'h4', 'h5', 'h6'].includes(tagName)) {\n            flushList();\n            let content = processChildren(child);\n            content = cleanText(content);\n            if (content) {\n                result.push(`<${tagName}>${content}</${tagName}>`);\n            }\n        } else {\n            // Other elements\n            flushList();\n            const content = processChildren(child);\n            if (content.trim()) {\n                result.push(`<p>${cleanText(content)}</p>`);\n            }\n        }\n    }\n\n    // Flush any remaining list\n    flushList();\n\n    return result.join('');\n}\n"],"names":["INVISIBLE_CHARS_REGEX","cleanText","input","cleanWordCruft","html","str","isListParagraph","el","className","isNumberedList","text","stripBulletMarkers","cleanElementAttributes","processElement","tagName","inner","processChildren","result","node","cleanWordHtml","cleanedHtml","container","contentContainer","bodyElement","currentList","flushList","tag","items","item","child","rawText","listType","itemHtml","content","li"],"mappings":"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"}